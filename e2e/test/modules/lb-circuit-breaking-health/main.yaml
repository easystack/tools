steps:
- name: Starting measurement for gated launch application
  measurements:
  - Method: WaitForControlledPodsRunning
    Instances:
    - Identifier: WaitForRunningDeployments
      Params:
        apiVersion: apps/v1
        kind: Deployment
    Params:
      action: start
      labelSelector: group = lb-circuit-breaking-health
      operationTimeout: "120s"

- name: Create prism-conf Config
  phases:
  - namespaceRange:
      min: 20
      max: 20
    replicasPerNamespace: 1
    tuningSet: {{.tuningSet}}
    objectBundle:
    - basename: prism-conf
      objectTemplatePath: modules/lb-circuit-breaking-health/prism-conf.yaml

- name: Create lb-circuit-breaking-health service and deploy
  phases:
  - namespaceRange:
      min: 20
      max: 20
    replicasPerNamespace: 1
    tuningSet: {{.tuningSet}}
    objectBundle:
    - basename: mockserver
      objectTemplatePath: modules/lb-circuit-breaking-health/mockserver-svc.yaml
    - basename: mockserver-v1-deploy
      objectTemplatePath: modules/lb-circuit-breaking-health/mockserver-v1-deploy.yaml
    - basename: mockserver-v2-deploy
      objectTemplatePath: modules/lb-circuit-breaking-health/mockserver-v2-deploy.yaml
    - basename: mockserver-v3-deploy
      objectTemplatePath: modules/lb-circuit-breaking-health/mockserver-v3-deploy.yaml
    - basename: mockserver-v4-deploy
      objectTemplatePath: modules/lb-circuit-breaking-health/mockserver-v4-deploy.yaml
    - basename: mockserver-v5-deploy
      objectTemplatePath: modules/lb-circuit-breaking-health/mockserver-v5-deploy.yaml
    - basename: mockserver-v6-deploy
      objectTemplatePath: modules/lb-circuit-breaking-health/mockserver-v6-deploy.yaml
    - basename: mockserver-v7-deploy
      objectTemplatePath: modules/lb-circuit-breaking-health/mockserver-v7-deploy.yaml
    - basename: mockserver-v8-deploy
      objectTemplatePath: modules/lb-circuit-breaking-health/mockserver-v8-deploy.yaml
    - basename: mockserver-v9-deploy
      objectTemplatePath: modules/lb-circuit-breaking-health/mockserver-v9-deploy.yaml
    - basename: mockserver-v10-deploy
      objectTemplatePath: modules/lb-circuit-breaking-health/mockserver-v10-deploy.yaml

- name: Waiting for wordpress application setup to be completed
  measurements:
  - Method: WaitForControlledPodsRunning
    Instances:
    - Identifier: WaitForRunningDeployments
    Params:
      action: gather

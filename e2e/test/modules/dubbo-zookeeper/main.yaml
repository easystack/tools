steps:
- name: Starting measurement for dubbo-zookeeper application
  measurements:
  - Method: WaitForControlledPodsRunning
    Instances:
    - Identifier: WaitForRunningDeployments
      Params:
        apiVersion: apps/v1
        kind: Deployment
    Params:
      action: start
      labelSelector: group = dubbo-zookeeper
      operationTimeout: "120s"

- name: Create zookeeper service and deploy
  phases:
  - namespaceRange:
      min: 32
      max: 32
    replicasPerNamespace: 1
    tuningSet: {{.tuningSet}}
    objectBundle:
    - basename: zookeeper
      objectTemplatePath: modules/dubbo-zookeeper/zookeeper-svc.yaml
    - basename: zookeeper
      objectTemplatePath: modules/dubbo-zookeeper/zookeeper-deploy.yaml

- name: Create dubbo-zookeeper service and deploy
  phases:
  - namespaceRange:
      min: 32
      max: 32
    replicasPerNamespace: 1
    tuningSet: {{.tuningSet}}
    objectBundle:
    - basename: dubbo-consumer-test-zookeeper
      objectTemplatePath: modules/dubbo-zookeeper/dubbo-consumer-zookeeper-svc.yaml
    - basename: dubbo-provider-test-zookeeper
      objectTemplatePath: modules/dubbo-zookeeper/dubbo-provider-zookeeper-deploy.yaml
    - basename: dubbo-consumer-test-zookeeper
      objectTemplatePath: modules/dubbo-zookeeper/dubbo-consumer-zookeeper-deploy.yaml

- name: Waiting for wordpress application setup to be completed
  measurements:
  - Method: WaitForControlledPodsRunning
    Instances:
    - Identifier: WaitForRunningDeployments
    Params:
      action: gather
